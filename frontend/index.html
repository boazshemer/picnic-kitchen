<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×¡×¤×™×¨×ª ×× ×•×ª ×™×•× - ××¤×¢×œ ××–×•×Ÿ</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* ×”×ª×××•×ª ××™×•×—×“×•×ª ×œ×¢×‘×¨×™×ª */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
        }
        
        /* ×× ×™××¦×™×•×ª ×—×œ×§×•×ª */
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ×¡×’× ×•×Ÿ ×œ×›×¤×ª×•×¨×™ + - */
        .counter-btn {
            transition: all 0.2s;
        }
        
        .counter-btn:active {
            transform: scale(0.95);
        }
        
        /* Autocomplete dropdown */
        .autocomplete-items {
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    
    <!-- ××¡×š ×”×ª×—×‘×¨×•×ª -->
    <div id="loginScreen" class="fixed inset-0 bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md mx-4">
            <div class="text-center mb-6">
                <!-- ×œ×•×’×• ×¤×™×§× ×™×§ ××¢×“× ×™× ×˜×§×¡×˜×•××œ×™ -->
                <div class="mb-4">
                    <div class="text-5xl font-bold text-orange-600 mb-2">ğŸ½ï¸</div>
                    <h1 class="text-3xl font-bold text-orange-600">×¤×™×§× ×™×§ ××¢×“× ×™×</h1>
                    <p class="text-sm text-orange-400">×××– 1969</p>
                </div>
                <p class="text-lg text-gray-700 leading-relaxed">
                    ×‘×¨×•×›×” ×”×‘××” ×œ××¢×¨×›×ª ×”×—×›××”<br>
                    <span class="text-base">×‘×›×“×™ ×œ×”×ª×—×‘×¨ ×”×§×© ××ª ×¡×¡××ª×š</span>
                </p>
            </div>
            
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    ğŸ” ×”×–×Ÿ ×¡×™×¡××”
                </label>
                <input 
                    type="password" 
                    id="passwordInput"
                    placeholder="×”×§×œ×“ ×¡×™×¡××”..."
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg"
                    autocomplete="off"
                >
                <p id="loginError" class="text-red-500 text-sm mt-2 hidden">âŒ ×¡×™×¡××” ×©×’×•×™×”, × ×¡×” ×©×•×‘</p>
            </div>
            
            <button 
                id="loginBtn"
                class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-all"
            >
                ×›× ×™×¡×”
            </button>
            
            <p class="text-center text-xs text-gray-500 mt-4">
                ××¢×¨×›×ª ×××•×‘×˜×—×ª - ×œ×©×™××•×© ××•×¨×©×™× ×‘×œ×‘×“
            </p>
        </div>
    </div>
    
    <!-- ×ª×•×›×Ÿ ×”×“×£ ×”×¨××©×™ (××•×¡×ª×¨ ×¢×“ ×”×ª×—×‘×¨×•×ª) -->
    <div id="mainContent" class="hidden">
    
    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-10">
        <div class="max-w-md mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="text-2xl">ğŸ½ï¸</div>
                <div>
                    <h1 class="text-lg font-bold text-orange-600">×¤×™×§× ×™×§ ××¢×“× ×™×</h1>
                    <p class="text-xs text-gray-500">×¡×¤×™×¨×ª ×× ×•×ª ×™×•×</p>
                </div>
            </div>
            <button 
                id="logoutBtn"
                class="text-sm text-red-600 hover:text-red-700 underline"
            >
                ×™×¦×™××”
            </button>
        </div>
    </header>

    <!-- Main Container -->
    <main class="max-w-md mx-auto px-4 py-6 pb-24">
        
        <!-- ×‘×—×™×¨×ª ×× ×” -->
        <div class="bg-white rounded-lg shadow-sm p-4 mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">
                ×©× ×× ×”
            </label>
            <div class="relative">
                <input 
                    type="text" 
                    id="dishSearch"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    placeholder="×—×¤×© ×× ×”..."
                    autocomplete="off"
                >
                <!-- Autocomplete Dropdown -->
                <div id="autocompleteDropdown" class="hidden absolute w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-20 autocomplete-items">
                </div>
            </div>
        </div>

        <!-- ×¤×¨×˜×™ ×”×× ×” ×©× ×‘×—×¨×” -->
        <div id="selectedDishDetails" class="hidden fade-in">
            
            <!-- ×©× ×˜×‘×— ×•×§×•××” -->
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                <div class="flex items-center justify-between mb-2">
                    <div>
                        <label class="block text-xs text-gray-600 mb-1">×©× ×˜×‘×—</label>
                        <p id="cookName" class="font-medium text-gray-800"></p>
                    </div>
                    <div>
                        <label class="block text-xs text-gray-600 mb-1 text-left">×§×•××”</label>
                        <p id="cookFloor" class="font-medium text-gray-800 text-left"></p>
                    </div>
                </div>
                
                <!-- ×›×¤×ª×•×¨ ×œ×©×™× ×•×™ ×˜×‘×— -->
                <button 
                    id="changeCookBtn"
                    class="text-sm text-blue-600 hover:text-blue-700 underline"
                >
                    ×©× ×” ×˜×‘×—
                </button>
            </div>

            <!-- Dropdown ×œ×©×™× ×•×™ ×˜×‘×— (××•×¡×ª×¨ ×‘×”×ª×—×œ×”) -->
            <div id="cookChangeSection" class="hidden bg-white rounded-lg shadow-sm p-4 mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    ×‘×—×¨ ×˜×‘×— ××—×¨
                </label>
                <select 
                    id="cookDropdown"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                >
                </select>
            </div>

            <!-- ×‘×—×™×¨×ª ×›××•×ª -->
            <div class="bg-white rounded-lg shadow-sm p-4 mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-3">
                    ×× ×” × ×‘×—×¨×ª: <span id="selectedDishName" class="text-blue-600"></span>
                </label>
                
                <!-- ×›××•×ª + ×™×—×™×“×ª ××™×“×” -->
                <div class="mb-4">
                    <label class="text-sm font-medium text-gray-700 mb-2 block">
                        ×›××•×ª
                    </label>
                    <div class="flex items-center gap-3">
                        <button 
                            id="decrementBtn"
                            class="counter-btn w-10 h-10 bg-gray-100 hover:bg-gray-200 rounded-lg font-bold text-xl flex-shrink-0"
                        >
                            âˆ’
                        </button>
                        <input 
                            type="number" 
                            id="quantity"
                            value="0"
                            min="0"
                            class="w-20 text-center text-2xl font-bold border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent p-2"
                            inputmode="numeric"
                        >
                        <button 
                            id="incrementBtn"
                            class="counter-btn w-10 h-10 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-bold text-xl flex-shrink-0"
                        >
                            +
                        </button>
                        
                        <!-- ×™×—×™×“×ª ××™×“×” -->
                        <select 
                            id="unitType"
                            class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-base font-medium flex-shrink-0"
                        >
                            <option value="×™×—×³" selected>×™×—×³</option>
                            <option value="×§×´×’">×§×´×’</option>
                            <option value="××—×¨">××—×¨</option>
                        </select>
                    </div>
                    
                    <!-- ×©×“×” ×˜×§×¡×˜ ×—×•×¤×©×™ ×œ×™×—×™×“×ª ××™×“×” ××—×¨×ª (××•×¡×ª×¨ ×‘×”×ª×—×œ×”) -->
                    <div id="customUnitSection" class="hidden mt-2">
                        <input 
                            type="text" 
                            id="customUnit"
                            placeholder="×”×–×Ÿ ×™×—×™×“×ª ××™×“×”"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                        >
                    </div>
                </div>

                <!-- ×”×¢×¨×” ×œ×˜×‘×— -->
                <div class="mb-4">
                    <label class="text-sm font-medium text-gray-700 mb-2 block">
                        ×”×¢×¨×” ×œ×˜×‘×— (××•×¤×¦×™×•× ×œ×™)
                    </label>
                    <textarea 
                        id="noteForCook"
                        rows="2"
                        placeholder="×œ××©×œ: ×‘×œ×™ ×‘×¦×œ, ×¤×—×•×ª ×—×¨×™×£..."
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 resize-none text-sm"
                    ></textarea>
                </div>
            </div>

            <!-- ×›×¤×ª×•×¨ ×”×•×¡×¤×” ×œ×¨×©×™××” -->
            <button 
                id="addToListBtn"
                class="w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg shadow-sm mb-4"
            >
                ×”×•×¡×£ ×œ×¨×©×™××”
            </button>
        </div>

        <!-- ×¨×©×™××ª ×”×–×× ×•×ª -->
        <div id="ordersList" class="hidden">
            <h2 class="text-lg font-bold text-gray-800 mb-3">×¨×©×™××ª ×”×–×× ×•×ª</h2>
            <div id="ordersContainer" class="space-y-2 mb-4">
                <!-- ×”×–×× ×•×ª ×™×ª×•×•×¡×¤×• ×›××Ÿ -->
            </div>
        </div>

    </main>

    <!-- Bottom Bar - ×›×¤×ª×•×¨ ×©×œ×™×—×” -->
    <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 shadow-lg">
        <div class="max-w-md mx-auto">
            <button 
                id="sendToKitchenBtn"
                class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-6 rounded-lg shadow-lg disabled:bg-gray-300 disabled:cursor-not-allowed transition-all"
                disabled
            >
                ğŸš€ ×¡×’×•×¨ ×•×©×œ×— ×œ×’×™×
            </button>
            <p id="totalCount" class="text-center text-sm text-gray-500 mt-2">
                ×¡×”×´×›: 0 ×× ×•×ª
            </p>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
            <p class="mt-4 text-gray-700">×©×•×œ×—...</p>
        </div>
    </div>

    </div><!-- ×¡×•×£ mainContent -->

    <script>
        // ================================================
        // ××¢×¨×›×ª ×”×ª×—×‘×¨×•×ª
        // ================================================
        
        const CORRECT_PASSWORD = 'picnic2025';
        const PASSWORD_KEY = 'kitchen_auth';
        
        // ×‘×“×™×§×” ×× ×”××©×ª××© ×›×‘×¨ ×”×ª×—×‘×¨
        function checkAuth() {
            const savedPassword = localStorage.getItem(PASSWORD_KEY);
            if (savedPassword === CORRECT_PASSWORD) {
                showMainContent();
                return true;
            }
            return false;
        }
        
        // ×”×¦×’×ª ×ª×•×›×Ÿ ×¨××©×™
        function showMainContent() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainContent').classList.remove('hidden');
        }
        
        // ×”×ª×—×‘×¨×•×ª
        document.getElementById('loginBtn').addEventListener('click', function() {
            const password = document.getElementById('passwordInput').value;
            const errorMsg = document.getElementById('loginError');
            
            if (password === CORRECT_PASSWORD) {
                localStorage.setItem(PASSWORD_KEY, password);
                showMainContent();
                loadDishes(); // ×˜×¢×™× ×ª ×× ×•×ª ××—×¨×™ ×”×ª×—×‘×¨×•×ª
            } else {
                errorMsg.classList.remove('hidden');
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
            }
        });
        
        // ××¤×©×¨×•×ª ×œ×”×ª×—×‘×¨ ×¢× Enter
        document.getElementById('passwordInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('loginBtn').click();
            }
        });
        
        // ×™×¦×™××”
        document.getElementById('logoutBtn').addEventListener('click', function() {
            if (confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×¦××ª?')) {
                localStorage.removeItem(PASSWORD_KEY);
                location.reload();
            }
        });
        
        // ×‘×“×™×§×” ×‘×˜×¢×™× ×ª ×”×“×£
        if (!checkAuth()) {
            document.getElementById('passwordInput').focus();
        }
        
        // ================================================
        // ×”×’×“×¨×•×ª ×•××©×ª× ×™× ×’×œ×•×‘×œ×™×™×
        // ================================================
        
        // ×–×™×”×•×™ ××•×˜×•××˜×™ ×©×œ ×›×ª×•×‘×ª ×”×©×¨×ª
        const API_BASE_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? 'http://localhost:8001'
            : window.location.origin;
        
        let allDishes = [];           // ×›×œ ×”×× ×•×ª ××”×©×¨×ª
        let allCooks = [];            // ×›×œ ×”×˜×‘×—×™×
        let selectedDish = null;      // ×”×× ×” ×©× ×‘×—×¨×” ×›×¨×’×¢
        let selectedCook = null;      // ×”×˜×‘×— ×©× ×‘×—×¨ ×›×¨×’×¢
        let orderItems = [];          // ×¨×©×™××ª ×”×”×–×× ×•×ª
        let todayOrderDate = new Date().toISOString().split('T')[0]; // ×ª××¨×™×š ×”×™×•×

        // ================================================
        // ×˜×¢×™× ×ª × ×ª×•× ×™× ××”×©×¨×ª
        // ================================================
        
        async function loadDishes() {
            try {
                const response = await fetch(`${API_BASE_URL}/dishes`);
                if (!response.ok) throw new Error('Failed to fetch dishes');
                allDishes = await response.json();
                console.log('âœ… × ×˜×¢× ×•', allDishes.length, '×× ×•×ª');
                
                // ×©×œ×™×¤×ª ×¨×©×™××ª ×˜×‘×—×™× ××”×× ×•×ª
                allCooks = [];
                const cookMap = new Map();
                allDishes.forEach(dish => {
                    if (dish.default_cook && !cookMap.has(dish.default_cook.id)) {
                        cookMap.set(dish.default_cook.id, dish.default_cook);
                        allCooks.push(dish.default_cook);
                    }
                });
                console.log('âœ… × ××¦××•', allCooks.length, '×˜×‘×—×™×');
                
                // ×˜×¢×™× ×ª ×”×–×× ×ª ×”×™×•×
                await loadTodayOrder();
                
            } catch (error) {
                console.error('âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×× ×•×ª:', error);
                alert('×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™×. ×•×•×“× ×©×”×©×¨×ª ×¨×¥ ×¢×œ http://localhost:8001');
            }
        }
        
        async function loadTodayOrder() {
            try {
                const response = await fetch(`${API_BASE_URL}/today-order?date=${todayOrderDate}`);
                if (!response.ok) return; // ××™×Ÿ ×”×–×× ×•×ª ×œ×”×™×•× - ×–×” ×‘×¡×“×¨
                
                const data = await response.json();
                
                if (data.items && data.items.length > 0) {
                    console.log('ğŸ“‹ × ××¦××” ×”×–×× ×” ×§×™×™××ª:', data.items.length, '×¤×¨×™×˜×™×');
                    
                    // ×”××¨×ª ×”×”×–×× ×•×ª ×œ×¤×•×¨××˜ ×”××§×•××™
                    orderItems = data.items.map(item => ({
                        id: item.id,  // ×©××™×¨×ª ×”-ID ×œ××—×™×§×”/×¢×“×›×•×Ÿ
                        dish_id: item.dish.id,
                        dish_name: item.dish.name,
                        assigned_cook_id: item.assigned_cook.id,
                        cook_name: item.assigned_cook.name,
                        cook_floor: item.assigned_cook.floor,
                        quantity: item.quantity,
                        unit: '×™×—×³',  // ×‘×¨×™×¨×ª ××—×“×œ
                        note: item.notes || ''
                    }));
                    
                    updateOrdersList();
                    
                    // ×”×¦×’×ª ×”×•×“×¢×”
                    alert(`ğŸ“‹ × ××¦××” ×”×–×× ×” ×§×™×™××ª ××”×™×•×!\n×¡×”"×› ${data.items.length} ×¤×¨×™×˜×™×\n\n× ×™×ª×Ÿ ×œ×”×•×¡×™×£ ×× ×•×ª ××• ×œ×¢×¨×•×š ××ª ×”×”×–×× ×”`);
                }
            } catch (error) {
                console.error('âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×”×–×× ×ª ×”×™×•×:', error);
                // ×œ× × ×¦×™×’ ×©×’×™××” - ××•×œ×™ ×¤×©×•×˜ ××™×Ÿ ×”×–×× ×•×ª
            }
        }

        // ================================================
        // Autocomplete - ×—×™×¤×•×© ×× ×•×ª
        // ================================================
        
        const dishSearch = document.getElementById('dishSearch');
        const autocompleteDropdown = document.getElementById('autocompleteDropdown');
        
        dishSearch.addEventListener('input', function() {
            const searchText = this.value.trim();
            
            if (searchText.length === 0) {
                autocompleteDropdown.classList.add('hidden');
                return;
            }
            
            // ×¡×™× ×•×Ÿ ×× ×•×ª - ×¨×§ ×× ×•×ª ×©××ª×—×™×œ×•×ª ×¢× ×˜×§×¡×˜ ×”×—×™×¤×•×©
            const filtered = allDishes.filter(dish => 
                dish.name.startsWith(searchText)
            );
            
            if (filtered.length === 0) {
                autocompleteDropdown.classList.add('hidden');
                return;
            }
            
            // ×”×¦×’×ª ×ª×•×¦××•×ª
            autocompleteDropdown.innerHTML = filtered.map(dish => `
                <div class="px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-0"
                     onclick="selectDish('${dish.id}')">
                    <p class="font-medium text-gray-800">${dish.name}</p>
                    <p class="text-sm text-gray-500">${dish.category || ''}</p>
                </div>
            `).join('');
            
            autocompleteDropdown.classList.remove('hidden');
        });

        // ================================================
        // ×‘×—×™×¨×ª ×× ×”
        // ================================================
        
        function selectDish(dishId) {
            selectedDish = allDishes.find(d => d.id === dishId);
            if (!selectedDish) return;
            
            // ×¢×“×›×•×Ÿ UI
            dishSearch.value = selectedDish.name;
            autocompleteDropdown.classList.add('hidden');
            
            // ×”×¦×’×ª ×¤×¨×˜×™ ×”×× ×”
            document.getElementById('selectedDishDetails').classList.remove('hidden');
            document.getElementById('selectedDishName').textContent = selectedDish.name;
            
            // ×”×¦×’×ª ×˜×‘×— ×‘×¨×™×¨×ª ××—×“×œ
            if (selectedDish.default_cook) {
                selectedCook = selectedDish.default_cook;
                updateCookDisplay();
                populateCookDropdown();
            }
            
            // ××™×¤×•×¡ ×›××•×ª
            document.getElementById('quantity').value = 0;
        }

        // ================================================
        // ×¢×“×›×•×Ÿ ×ª×¦×•×’×ª ×”×˜×‘×—
        // ================================================
        
        function updateCookDisplay() {
            if (!selectedCook) return;
            
            document.getElementById('cookName').textContent = selectedCook.name;
            document.getElementById('cookFloor').textContent = selectedCook.floor || '-';
        }

        // ================================================
        // ××™×œ×•×™ Dropdown ×©×œ ×˜×‘×—×™×
        // ================================================
        
        function populateCookDropdown() {
            const dropdown = document.getElementById('cookDropdown');
            dropdown.innerHTML = allCooks.map(cook => `
                <option value="${cook.id}" ${cook.id === selectedCook?.id ? 'selected' : ''}>
                    ${cook.name} (×§×•××” ${cook.floor || '-'})
                </option>
            `).join('');
        }

        // ================================================
        // ×›×¤×ª×•×¨ ×©×™× ×•×™ ×˜×‘×—
        // ================================================
        
        document.getElementById('changeCookBtn').addEventListener('click', function() {
            const section = document.getElementById('cookChangeSection');
            section.classList.toggle('hidden');
        });
        
        document.getElementById('cookDropdown').addEventListener('change', function() {
            const cookId = this.value;
            selectedCook = allCooks.find(c => c.id === cookId);
            updateCookDisplay();
            document.getElementById('cookChangeSection').classList.add('hidden');
        });

        // ================================================
        // ×›×¤×ª×•×¨×™ +/- ×œ×›××•×ª
        // ================================================
        
        const quantityInput = document.getElementById('quantity');
        
        document.getElementById('incrementBtn').addEventListener('click', function() {
            let current = parseInt(quantityInput.value) || 0;
            quantityInput.value = current + 1;
        });
        
        document.getElementById('decrementBtn').addEventListener('click', function() {
            let current = parseInt(quantityInput.value) || 0;
            if (current > 0) {
                quantityInput.value = current - 1;
            }
        });

        // ================================================
        // ×™×—×™×“×ª ××™×“×” - ×”×¦×’×ª ×©×“×” ×—×•×¤×©×™ ×œ"××—×¨"
        // ================================================
        
        document.getElementById('unitType').addEventListener('change', function() {
            const customSection = document.getElementById('customUnitSection');
            if (this.value === '××—×¨') {
                customSection.classList.remove('hidden');
            } else {
                customSection.classList.add('hidden');
                document.getElementById('customUnit').value = '';
            }
        });

        // ================================================
        // ×”×•×¡×¤×” ×œ×¨×©×™××ª ×”×–×× ×•×ª (×©××™×¨×” ×‘×©×¨×ª)
        // ================================================
        
        document.getElementById('addToListBtn').addEventListener('click', async function() {
            const quantity = parseInt(quantityInput.value) || 0;
            
            if (quantity === 0) {
                alert('×™×© ×œ×‘×—×•×¨ ×›××•×ª');
                return;
            }
            
            if (!selectedDish || !selectedCook) {
                alert('×—×¡×¨×™× ×¤×¨×˜×™×');
                return;
            }
            
            // ×§×‘×œ×ª ×™×—×™×“×ª ××™×“×”
            const unitType = document.getElementById('unitType').value;
            let unit = unitType;
            if (unitType === '××—×¨') {
                unit = document.getElementById('customUnit').value.trim();
                if (!unit) {
                    alert('×™×© ×œ×”×–×™×Ÿ ×™×—×™×“×ª ××™×“×”');
                    return;
                }
            }
            
            // ×§×‘×œ×ª ×”×¢×¨×”
            const note = document.getElementById('noteForCook').value.trim();
            
            // ×©×œ×™×—×” ×œ×©×¨×ª
            try {
                document.getElementById('loadingSpinner').classList.remove('hidden');
                
                const response = await fetch(`${API_BASE_URL}/add-to-order`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        order_date: todayOrderDate,
                        dish_id: selectedDish.id,
                        quantity: quantity,
                        unit: unit,
                        notes: note,
                        assigned_cook_id: selectedCook.id
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || '×©×’×™××” ×‘×”×•×¡×¤×”');
                }
                
                const result = await response.json();
                console.log('âœ… ×× ×” × ×•×¡×¤×”:', result);
                
                // ×”×•×¡×¤×” ×œ×¨×©×™××” ×”××§×•××™×ª
                orderItems.push({
                    id: result.data.id,  // ×©××™×¨×ª ×”-ID
                    dish_id: selectedDish.id,
                    dish_name: selectedDish.name,
                    assigned_cook_id: selectedCook.id,
                    cook_name: selectedCook.name,
                    cook_floor: selectedCook.floor,
                    quantity: quantity,
                    unit: unit,
                    note: note
                });
                
                // ×¢×“×›×•×Ÿ ×ª×¦×•×’×”
                updateOrdersList();
                
                // ××™×¤×•×¡
                resetForm();
                
                alert('âœ… ×”×× ×” × ×•×¡×¤×” ×œ×”×–×× ×ª ×”×™×•×!');
                
            } catch (error) {
                console.error('âŒ ×©×’×™××”:', error);
                alert('âŒ ×©×’×™××” ×‘×”×•×¡×¤×ª ×× ×”: ' + error.message);
            } finally {
                document.getElementById('loadingSpinner').classList.add('hidden');
            }
        });

        // ================================================
        // ×¢×“×›×•×Ÿ ×¨×©×™××ª ×”×–×× ×•×ª
        // ================================================
        
        function updateOrdersList() {
            const container = document.getElementById('ordersContainer');
            const listSection = document.getElementById('ordersList');
            const sendBtn = document.getElementById('sendToKitchenBtn');
            const totalCount = document.getElementById('totalCount');
            
            if (orderItems.length === 0) {
                listSection.classList.add('hidden');
                sendBtn.disabled = true;
                totalCount.textContent = '×¡×”×´×›: 0 ×× ×•×ª';
                return;
            }
            
            listSection.classList.remove('hidden');
            sendBtn.disabled = false;
            
            // ×—×™×©×•×‘ ×¡×”"×›
            const total = orderItems.reduce((sum, item) => sum + item.quantity, 0);
            totalCount.textContent = `×¡×”×´×›: ${total} ×× ×•×ª`;
            
            // ×”×¦×’×ª ×¨×©×™××”
            container.innerHTML = orderItems.map((item, index) => `
                <div class="bg-white rounded-lg p-3 shadow-sm">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <p class="font-medium text-gray-800">${item.dish_name}</p>
                            <p class="text-sm text-gray-500">×˜×‘×—: ${item.cook_name} (×§×•××” ${item.cook_floor})</p>
                            <p class="text-sm font-medium text-blue-600">×›××•×ª: ${item.quantity} ${item.unit}</p>
                            ${item.note ? `<p class="text-sm text-orange-600 mt-1">ğŸ’¬ ${item.note}</p>` : ''}
                        </div>
                        <button 
                            onclick="removeOrder(${index})"
                            class="text-red-500 hover:text-red-700 p-1"
                        >
                            âœ•
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // ================================================
        // ×”×¡×¨×ª ×”×–×× ×”
        // ================================================
        
        async function removeOrder(index) {
            const item = orderItems[index];
            
            if (!item.id) {
                // ×¤×¨×™×˜ ×©×˜×¨× × ×©××¨ ×‘×©×¨×ª - ××—×™×§×” ××§×•××™×ª ×‘×œ×‘×“
                orderItems.splice(index, 1);
                updateOrdersList();
                return;
            }
            
            if (!confirm(`×”×× ×œ××—×•×§ ××ª ${item.dish_name}?`)) {
                return;
            }
            
            try {
                document.getElementById('loadingSpinner').classList.remove('hidden');
                
                const response = await fetch(`${API_BASE_URL}/order-item/${item.id}`, {
                    method: 'DELETE'
                });
                
                if (!response.ok) {
                    throw new Error('×©×’×™××” ×‘××—×™×§×”');
                }
                
                console.log('âœ… ×¤×¨×™×˜ × ××—×§');
                
                // ××—×™×§×” ××§×•××™×ª
                orderItems.splice(index, 1);
                updateOrdersList();
                
            } catch (error) {
                console.error('âŒ ×©×’×™××” ×‘××—×™×§×”:', error);
                alert('âŒ ×©×’×™××” ×‘××—×™×§×ª ×”×¤×¨×™×˜');
            } finally {
                document.getElementById('loadingSpinner').classList.add('hidden');
            }
        }

        // ================================================
        // ××™×¤×•×¡ ×˜×•×¤×¡
        // ================================================
        
        function resetForm() {
            dishSearch.value = '';
            selectedDish = null;
            selectedCook = null;
            document.getElementById('selectedDishDetails').classList.add('hidden');
            document.getElementById('cookChangeSection').classList.add('hidden');
            document.getElementById('quantity').value = 0;
            document.getElementById('unitType').value = '×™×—×³';
            document.getElementById('customUnit').value = '';
            document.getElementById('customUnitSection').classList.add('hidden');
            document.getElementById('noteForCook').value = '';
        }

        // ================================================
        // ×¡×’×™×¨×” ×•×©×œ×™×—×” ×œ×’×™× - POST /finalize-order
        // ================================================
        
        document.getElementById('sendToKitchenBtn').addEventListener('click', async function() {
            if (orderItems.length === 0) return;
            
            const confirmMsg = `ğŸš€ ×”×× ×œ×¡×’×•×¨ ××ª ×”×–×× ×ª ×”×™×•× ×•×œ×©×œ×•×— ×œ×’×™×?\n\n×¡×”"×› ${orderItems.length} ×¤×¨×™×˜×™×\n\nâš ï¸ ×œ××—×¨ ×”×©×œ×™×—×” ×œ× × ×™×ª×Ÿ ×œ×¢×¨×•×š!`;
            
            if (!confirm(confirmMsg)) {
                return;
            }
            
            console.log('ğŸ“¤ ×¡×•×’×¨ ×•×©×•×œ×— ×”×–×× ×”');
            
            // ×”×¦×’×ª loading
            document.getElementById('loadingSpinner').classList.remove('hidden');
            
            try {
                const response = await fetch(`${API_BASE_URL}/finalize-order?order_date=${todayOrderDate}`, {
                    method: 'POST'
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || '×©×’×™××” ×‘×©×œ×™×—×”');
                }
                
                const result = await response.json();
                console.log('âœ… ×”×–×× ×” × ×©×œ×—×”:', result);
                
                // ×”×¦×œ×—×”!
                alert('âœ… ×”×”×–×× ×” × ×¡×’×¨×” ×•× ×©×œ×—×” ×œ×’×™× ×‘×”×¦×œ×—×”!\n\n' + result.message);
                
                // ××™×¤×•×¡
                orderItems = [];
                updateOrdersList();
                resetForm();
                
            } catch (error) {
                console.error('âŒ ×©×’×™××”:', error);
                alert('âŒ ×©×’×™××” ×‘×©×œ×™×—×ª ×”×–×× ×”: ' + error.message);
            } finally {
                document.getElementById('loadingSpinner').classList.add('hidden');
            }
        });

        // ================================================
        // ×˜×¢×™× ×” ×¨××©×•× ×™×ª
        // ================================================
        
        window.addEventListener('DOMContentLoaded', async function() {
            console.log('ğŸš€ ××¤×¢×™×œ ××¤×œ×™×§×¦×™×”...');
            // ×˜×¢×™× ×ª ×× ×•×ª ×¨×§ ×× ×”××©×ª××© ××—×•×‘×¨
            if (localStorage.getItem(PASSWORD_KEY) === CORRECT_PASSWORD) {
                await loadDishes();
                console.log('âœ… ××•×›×Ÿ!');
            }
        });
    </script>
</body>
</html>
